<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>TRD Style Cluster Simulation</title>
    <style>
        body { background: #111; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; color: white; font-family: sans-serif; }
        canvas { background: #000; border: 5px solid #333; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .controls { position: absolute; bottom: 20px; text-align: center; width: 100%; }
    </style>
</head>
<body>

<canvas id="cluster" width="800" height="350"></canvas>

<div class="controls">
    <p>アクセル（画面クリック）で加速・回転数アップ</p>
</div>

<script>
const canvas = document.getElementById('cluster');
const ctx = canvas.getContext('2d');

let speed = 0;
let rpm = 0;
let isAccelerating = false;

// イベントリスナー
window.onmousedown = () => isAccelerating = true;
window.onmouseup = () => isAccelerating = false;

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // 背景の描画
    drawGauge(ctx, 200, 175, 140, 0, 240, speed, "km/h", "TRD");
    drawGauge(ctx, 600, 175, 140, 0, 8, rpm, "x1000r/min", "");

    // ロジック更新
    if (isAccelerating) {
        speed += 0.5;
        rpm += 0.05;
        if (speed > 240) speed = 240;
        if (rpm > 8) rpm = 7.8 + Math.random() * 0.2; // レブリミット付近で振れる
    } else {
        speed -= 0.3;
        rpm -= 0.08;
        if (speed < 0) speed = 0;
        if (rpm < 0.8) rpm = 0.8; // アイドリング
    }

    requestAnimationFrame(draw);
}

function drawGauge(ctx, x, y, radius, min, max, value, unit, label) {
    // 外枠
    ctx.beginPath();
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 2;
    ctx.arc(x, y, radius, 0.75 * Math.PI, 2.25 * Math.PI);
    ctx.stroke();

    // 目盛り（簡略化）
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillStyle = "white";
    ctx.font = "bold 16px Arial";

    for (let i = min; i <= max; i += (max / 10)) {
        let angle = 0.75 * Math.PI + (i / max) * 1.5 * Math.PI;
        let x1 = x + Math.cos(angle) * (radius - 10);
        let y1 = y + Math.sin(angle) * (radius - 10);
        let tx = x + Math.cos(angle) * (radius - 30);
        let ty = y + Math.sin(angle) * (radius - 30);
        
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x + Math.cos(angle) * radius, y + Math.sin(angle) * radius);
        ctx.stroke();
        ctx.fillText(Math.floor(i), tx, ty);
    }

    // 単位とロゴ
    ctx.font = "14px Arial";
    ctx.fillText(unit, x, y + 60);
    ctx.font = "bold 20px Arial";
    ctx.fillText(label, x, y - 40);

    // 針
    let needleAngle = 0.75 * Math.PI + (value / max) * 1.5 * Math.PI;
    ctx.beginPath();
    ctx.strokeStyle = "#ffae00"; // オレンジ色の針
    ctx.lineWidth = 4;
    ctx.moveTo(x, y);
    ctx.lineTo(x + Math.cos(needleAngle) * (radius - 20), y + Math.sin(needleAngle) * (radius - 20));
    ctx.stroke();
    
    // 針のセンターキャップ
    ctx.beginPath();
    ctx.arc(x, y, 10, 0, 2 * Math.PI);
    ctx.fillStyle = "#222";
    ctx.fill();
}

draw();
</script>
</body>
</html>
