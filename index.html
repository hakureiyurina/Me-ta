<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRD Boost Custom</title>
    <style>
        body { background: #050505; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; margin: 0; color: #eee; font-family: sans-serif; }
        canvas { background: #000; border: 3px solid #333; border-radius: 20px; max-width: 95vw; box-shadow: 0 0 20px rgba(0,0,0,1); }
        .ui-panel { margin-top: 20px; display: flex; gap: 20px; align-items: center; }
        /* ブーストボタンをラフの「Br」サークル風に */
        #boostBtn { 
            width: 80px; height: 80px; border-radius: 50%; border: 4px solid #c00;
            background: #200; color: #f00; font-weight: bold; font-size: 20px;
            cursor: pointer; transition: 0.2s; box-shadow: 0 0 10px #c00;
        }
        #boostBtn.active { background: #f00; color: #fff; box-shadow: 0 0 30px #f00; transform: scale(1.1); }
        #toggleBtn { padding: 10px 20px; background: #444; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<canvas id="cluster" width="850" height="400"></canvas>

<div class="ui-panel">
    <button id="toggleBtn">ENGINE START</button>
    <button id="boostBtn">Br</button>
</div>

<script>
const canvas = document.getElementById('cluster');
const ctx = canvas.getContext('2d');
const btn = document.getElementById('toggleBtn');
const boostBtn = document.getElementById('boostBtn');

let isRunning = false;
let isBoost = false;
let currentMbps = 0, targetMbps = 0;
let currentRpm = 0, targetRpm = 0;

// データ更新 (0.5秒おき)
function update() {
    if (!isRunning) return;
    const conn = navigator.connection || { downlink: 40 };
    let speed = conn.downlink || 40;

    if (isBoost) {
        targetMbps = speed * 1.5 + Math.random() * 20;
        targetRpm = 5000 + (targetMbps * 20);
    } else {
        targetMbps = speed;
        targetRpm = 1000 + (targetMbps * 30);
    }
}
setInterval(update, 500);

btn.onclick = () => {
    isRunning = !isRunning;
    btn.innerText = isRunning ? "STOP" : "START";
    if (!isRunning) { targetMbps = 0; targetRpm = 0; isBoost = false; boostBtn.classList.remove('active'); }
};

boostBtn.onclick = () => { if(isRunning) { isBoost = !isBoost; boostBtn.classList.toggle('active'); } };

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    let easing = isBoost ? 0.2 : 0.08;
    currentMbps += (targetMbps - currentMbps) * easing;
    currentRpm += (targetRpm - currentRpm) * easing;

    // 左：スピードメーター（ラフの60, 100, 120を強調）
    drawGauge(ctx, 240, 200, 160, 0, 240, currentMbps, "Mbps", isBoost);
    
    // 右：タコメーター（ラフの10, 20, 30, 40を強調 ※スケールを合わせるため1000倍表記）
    drawGauge(ctx, 610, 200, 160, 0, 8000, currentRpm, "RPM", isBoost);

    requestAnimationFrame(draw);
}

function drawGauge(ctx, x, y, radius, min, max, value, label, boostMode) {
    const startAngle = 0.75 * Math.PI;
    const endAngle = 2.25 * Math.PI;

    // 外枠
    ctx.strokeStyle = boostMode ? "#f00" : "#444";
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.arc(x, y, radius, startAngle, endAngle);
    ctx.stroke();

    // 目盛り描画
    let step = boostMode ? (max / 40) : (max / 8); 
    for (let i = min; i <= max; i += step) {
        let angle = startAngle + ((i - min) / (max - min)) * (endAngle - startAngle);
        let isMain = i % (max / 8) === 0;
        
        ctx.strokeStyle = isMain ? "white" : "#333";
        ctx.lineWidth = isMain ? 2 : 1;
        ctx.beginPath();
        ctx.moveTo(x + Math.cos(angle) * (radius - (isMain ? 12 : 5)), y + Math.sin(angle) * (radius - (isMain ? 12 : 5)));
        ctx.lineTo(x + Math.cos(angle) * radius, y + Math.sin(angle) * radius);
        ctx.stroke();

        if (isMain) {
            ctx.fillStyle = "white";
            ctx.font = "italic bold 16px Arial";
            let tx = x + Math.cos(angle) * (radius - 35);
            let ty = y + Math.sin(angle) * (radius - 35);
            // ラフに基づいた数字の表示
            let val = (max === 8000) ? i/100 : i; // 右側を10, 20, 30...風に
            ctx.fillText(Math.floor(val), tx, ty);
        }
    }

    // 針
    let needleAngle = startAngle + ((value - min) / (max - min)) * (endAngle - startAngle);
    ctx.shadowBlur = boostMode ? 15 : 0;
    ctx.shadowColor = "red";
    ctx.strokeStyle = boostMode ? "#fff" : "#ff4500";
    ctx.lineWidth = 5;
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.lineTo(x + Math.cos(needleAngle) * (radius - 20), y + Math.sin(needleAngle) * (radius - 20));
    ctx.stroke();
    ctx.shadowBlur = 0;

    ctx.fillStyle = "#888";
    ctx.textAlign = "center";
    ctx.fillText(label, x, y + 50);
}

draw();
</script>
</body>
</html>
